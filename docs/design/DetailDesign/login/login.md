# ログイン画面 - 詳細設計

## 目的

- メールアドレスとパスワードで認証し、ログイン済み状態を作る。
- 認証成功後、アプリの主要画面（ホーム/学習項目一覧）へ遷移できるようにする。

## 対象画面

- 画面名: ログイン
- URL（案）: `/login`
- 遷移先（成功時）: `/`（ホーム/学習項目一覧）

## 前提 / 非対象

- 本設計は「メールアドレス + パスワードでログインする」ことのみを扱う。
- 以下は本設計の範囲外（別途設計が必要）
	- 新規登録（サインアップ）
	- パスワード再設定（Forgot Password）

## 画面構成（上から下）

1. 画面タイトル
2. 入力フォーム
	 - メールアドレス
	 - パスワード
3. 送信ボタン（ログイン）
4. エラーメッセージ領域（フォーム全体/サーバーエラー）

※ 本画面は未ログイン状態で表示される前提のため、共通ヘッダー/ヘッダーメニューは表示しない（または最小限のアプリ名表示のみ）。

## 詳細 UI 要素

### 1) タイトル

- 表示文言: 「ログイン」
- 表示方法: `TextMessage` などの既存 UI パーツで実装

### 2) メールアドレス入力

- ラベル: 「メールアドレス」
- プレースホルダ: `name@example.com`
- 必須: 必須
- 入力形式: メール形式
- 付加属性（実装指針）
	- `type="email"`
	- `inputMode="email"`
	- `autoComplete="email"`

### 3) パスワード入力

- ラベル: 「パスワード」
- プレースホルダ: `••••••••`
- 必須: 必須
- 付加属性（実装指針）
	- `type="password"`
	- `autoComplete="current-password"`

### 4) ログインボタン

- 表示文言: 「ログイン」
- コンポーネント: `BasicButton`
- ボタン種別: `type="submit"`
- 活性条件
	- 入力がバリデーションを満たしていること
	- 送信中でないこと
- 送信中
	- 二重送信防止のため disabled 相当（実装方法は任意）
	- ラベルは「ログイン」のままでも良い（UI追加はしない）

### 5) エラーメッセージ

- フィールド単位（例）
	- メールアドレスが未入力: 「メールアドレスを入力してください」
	- メール形式でない: 「メールアドレスの形式が正しくありません」
	- パスワードが未入力: 「パスワードを入力してください」
- フォーム全体（サーバー起因）
	- 401: 「メールアドレスまたはパスワードが正しくありません」
	- 429: 「しばらく時間をおいて再度お試しください」
	- 5xx/通信: 「ログインに失敗しました。通信状況をご確認のうえ再度お試しください」

## 入力バリデーション

フロントでの最小バリデーション（送信前）を以下とする。

| 項目 | ルール | エラーメッセージ |
| --- | --- | --- |
| メールアドレス | 必須 | メールアドレスを入力してください |
| メールアドレス | メール形式（`/\S+@\S+\.\S+/` 程度の簡易で可） | メールアドレスの形式が正しくありません |
| パスワード | 必須 | パスワードを入力してください |

補足:

- パスワードの最小文字数などの強度要件は、バックエンド側の認証仕様に合わせる（未確定の場合は本画面では必須のみ）。

## ユーザーフロー（代表ケース）

### A. 初期表示

1. `/login` を表示
2. メール/パスワードの入力フォームを表示

### B. ログイン成功

1. ユーザーがメール/パスワードを入力して「ログイン」を押下
2. バリデーションOKならログイン API を呼ぶ
3. 成功したらログイン済み状態を確立（cookie または token 保存）
4. `/`（ホーム）へ遷移

### C. ログイン失敗（認証失敗）

1. API が 401 を返す
2. フォーム全体エラーとして「メールアドレスまたはパスワードが正しくありません」を表示
3. 入力は保持し、再入力できる

## 状態管理（フロント）

### 画面状態

- `idle`: 入力待ち
- `submitting`: API 呼び出し中（ボタン無効化）
- `error`: エラー表示（idle に戻し、再送信可能）

### フォーム値（例）

- `email: string`
- `password: string`

実装は `react-hook-form` を使用し、送信は `@tanstack/react-query` の `useMutation` 等でよい。

## API 仕様（フロント向け・案）

バックエンド未実装のため、フロントが期待する I/F をここで定義する。

### ログイン

- メソッド: `POST`
- エンドポイント（案）: `/api/auth/login`
- リクエスト Body

```json
{
	"email": "name@example.com",
	"password": "string"
}
```

- レスポンス
	- `204 No Content`（推奨: サーバーが `Set-Cookie` でセッション確立）
	- もしくは `200 OK` でユーザー情報を返す場合

```json
{
	"user": {
		"id": "string",
		"email": "name@example.com"
	}
}
```

- エラー
	- `400`: バリデーションエラー（不正な形式/必須不足）
	- `401`: 認証失敗
	- `429`: レート制限
	- `500`: サーバーエラー

### ログイン状態確認（任意）

- メソッド: `GET`
- エンドポイント（案）: `/api/auth/me`
- 目的: リロード時にログイン済みか判定する
- レスポンス（例）

```json
{
	"user": {
		"id": "string",
		"email": "name@example.com"
	}
}
```

## エラーハンドリング方針

- 401 は「資格情報が間違っている」以外のヒントを出さない（ユーザー列挙対策）
- 通信エラー/5xx は、フォーム全体エラーとして表示し再試行可能にする

## アクセシビリティ

- すべての入力に `label` を紐付ける（`htmlFor` と `id`）
- エラー表示は対象フィールドと関連付ける
	- 例: `aria-invalid` / `aria-describedby`
- キーボード操作
	- Tab で「メール→パスワード→ログイン」へ自然にフォーカス移動
	- Enter で submit

## セキュリティ / 実装上の注意

- パスワードはログ出力しない（console/log/分析イベント送信の禁止）
- 送信中は二重送信を防止する
- 認証情報の保持は cookie（httpOnly）を優先（実装方式はバックエンドと整合させる）

## テストケース（受け入れ基準）

- メール未入力で送信すると、メールの必須エラーが表示される
- メール形式が不正な場合、形式エラーが表示される
- パスワード未入力で送信すると、パスワードの必須エラーが表示される
- 401 の場合、「メールアドレスまたはパスワードが正しくありません」が表示される
- 成功時、`/` に遷移する

## コンポーネント / 実装メモ

- 既存 UI パーツ
	- `TextField`（現状 `type="text"` 固定のため、`type` を受け取れるよう拡張が必要）
	- `BasicButton`
	- `TextMessage`

## 参照

- 画面遷移（基本設計）: [design/BasicDesign/ScreenTransitions/screen-transitions.md](design/BasicDesign/ScreenTransitions/screen-transitions.md)
